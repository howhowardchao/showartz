# è—æ£§ Showartz - é­”æ³•å•†åº—ç¶²ç«™

é€™æ˜¯ä¸€å€‹éŸ¿æ‡‰å¼çš„é­”æ³•å•†åº—ç¶²ç«™ï¼Œæ•´åˆ OpenAI Assistant API æä¾›å¡”ç¾…å åœèˆ‡å•†å“æ¨è–¦æœå‹™ï¼Œä¸¦å±•ç¤º IG çŸ­å½±ç‰‡ã€å•†å“è³‡è¨Šã€‚

## ğŸ“Œ ç‰ˆæœ¬è³‡è¨Š

**ç•¶å‰ç‰ˆæœ¬**: v1.1.1  
**æœ€å¾Œæ›´æ–°**: 2024-12-20  
**éƒ¨ç½²ç‹€æ…‹**: âœ… å·²éƒ¨ç½²è‡³ç”Ÿç”¢ç’°å¢ƒ (https://showartz.com)

### æœ€æ–°æ›´æ–° (v1.1.1 - 2024-12-20)
- âš¡ **æ€§èƒ½å„ªåŒ–å¯¦æ–½**ï¼š
  - API éŸ¿æ‡‰ç·©å­˜æ©Ÿåˆ¶ï¼šå•†å“å’Œå½±ç‰‡åˆ—è¡¨ API æ·»åŠ  60 ç§’ç·©å­˜ï¼ŒéŸ¿æ‡‰æ™‚é–“æ¸›å°‘ 70-90%
  - Analytics æŸ¥è©¢å„ªåŒ–ï¼šå°‡ 9 å€‹ç¨ç«‹æŸ¥è©¢åˆä½µç‚º 1 å€‹ CTE æŸ¥è©¢ï¼Œæ€§èƒ½æå‡ 60-80%
  - æ—¥èªŒç®¡ç†å·¥å…·ï¼šå‰µå»ºçµ±ä¸€æ—¥èªŒç³»çµ±ï¼Œç”Ÿç”¢ç’°å¢ƒæ—¥èªŒæ¸›å°‘ 80%+
  - å‰ç«¯çµ„ä»¶å„ªåŒ–ï¼šUserManager ä½¿ç”¨ useMemo/useCallbackï¼Œæ¸²æŸ“æ€§èƒ½æå‡ 30-50%
- ğŸ› **éŒ¯èª¤ä¿®å¾©**ï¼šä¿®å¾© Analytics Stats API SQL æŸ¥è©¢éŒ¯èª¤ã€Pageview API åƒæ•¸è™•ç†å•é¡Œ

### æ­·å²æ›´æ–° (v1.1.0 - 2024-12-20)
- ğŸ¨ **å‰ç«¯è¨­è¨ˆèª¿æ•´**ï¼šç°¡æ½”ä¿è½çš„ç¾ä»£åŒ– UI é¢¨æ ¼ï¼Œå„ªåŒ–é–“è·èˆ‡ä½ˆå±€
- ğŸ“Š **è¨ªå®¢çµ±è¨ˆç³»çµ±**ï¼šå®Œæ•´çš„ç¶²ç«™åˆ†æåŠŸèƒ½ï¼ŒåŒ…å«è¨ªå®¢æ•¸ã€æœƒè©±æ•¸ã€é é¢ç€è¦½ã€è£ç½®é¡å‹ç­‰çµ±è¨ˆ
- ğŸ‘¥ **æœƒå“¡ç®¡ç†ç³»çµ±**ï¼šå¾Œå°æœƒå“¡ç®¡ç†åŠŸèƒ½ï¼Œæ”¯æ´ç‹€æ…‹ç®¡ç†ã€æœƒå“¡ç­‰ç´šè¨­å®šã€Email é©—è­‰ç®¡ç†
- ğŸ”§ **ç³»çµ±å„ªåŒ–è¨ˆåŠƒ**ï¼šå®Œæ•´çš„å„ªåŒ–å ±å‘Šï¼ŒåŒ…å«æ€§èƒ½å„ªåŒ–ã€ä»£ç¢¼è³ªé‡æ”¹é€²å»ºè­°

### æ­·å²æ›´æ–° (v1.0.0 - 2025-12-13)
- âœ¨ **æ•…äº‹é é¢å„ªåŒ–**ï¼šåœ¨é è¦½åœ–ä¸‹æ–¹é¡¯ç¤ºå‰ 120 å­—æè¿°ï¼Œæå‡ç”¨æˆ¶é«”é©—
- ğŸ¨ **Logo æ›´æ–°**ï¼šèª¿æ•´ç‚ºæ©«å¼è¨­è¨ˆï¼ˆ2001x500pxï¼‰ï¼Œç§»é™¤æ–‡å­—æ¨™ç±¤ï¼ŒéŸ¿æ‡‰å¼é«˜åº¦ï¼ˆæ‰‹æ©Ÿ 34px / æ¡Œé¢ 42pxï¼‰
- ğŸ“¸ **ä¸Šå‚³è¦æ ¼æ¨™ç¤º**ï¼šåœ¨å¾Œå°ç®¡ç†ä»‹é¢æ¨™ç¤ºå»ºè­°çš„åœ–ç‰‡å°ºå¯¸èˆ‡æ¯”ä¾‹
- ğŸ”„ **å•†å“åŒæ­¥å„ªåŒ–**ï¼šè‡ªå‹•æ¨™è¨˜å·²ä¸‹æ¶å•†å“ç‚ºéæ´»èºç‹€æ…‹
- ğŸ› **ä¿®å¾©**ï¼šè§£æ±º 413 ä¸Šå‚³éŒ¯èª¤ã€404 åœ–ç‰‡è¼‰å…¥å•é¡Œã€502 Bad Gateway éŒ¯èª¤
- âš™ï¸ **éƒ¨ç½²å„ªåŒ–**ï¼šé…ç½® Nginx ç›´æ¥æœå‹™ä¸Šå‚³æ–‡ä»¶ã€å„ªåŒ–è³‡æ–™åº«é€£æ¥æ± ã€æ”¹é€²ç”Ÿç”¢ç’°å¢ƒæ—¥èªŒ

## ğŸ“‹ ç›®éŒ„

- [åŠŸèƒ½ç‰¹è‰²](#åŠŸèƒ½ç‰¹è‰²)
- [æŠ€è¡“æ£§](#æŠ€è¡“æ£§)
- [Logging & Diagnostics](#logging--diagnostics)
- [Scripts ä¸€è¦½èˆ‡æ­¸æª”è¦å‰‡](#scripts-ä¸€è¦½èˆ‡æ­¸æª”è¦å‰‡)
- [Documentation / README è¦å‰‡](#documentation--readme-è¦å‰‡)
- [ç³»çµ±æ¶æ§‹](#ç³»çµ±æ¶æ§‹)
- [é–‹ç™¼è¦æ ¼](#é–‹ç™¼è¦æ ¼)
- [é–‹ç™¼éç¨‹](#é–‹ç™¼éç¨‹)
- [ç’°å¢ƒè¨­å®š](#ç’°å¢ƒè¨­å®š)
- [æœ¬åœ°é–‹ç™¼](#æœ¬åœ°é–‹ç™¼)
- [API æ–‡æª”](#api-æ–‡æª”)
- [è³‡æ–™åº«çµæ§‹](#è³‡æ–™åº«çµæ§‹)
- [éƒ¨ç½²èªªæ˜](#éƒ¨ç½²èªªæ˜)

## åŠŸèƒ½ç‰¹è‰²

### ğŸ¬ IG å½±ç‰‡å±•ç¤º
- åƒ YouTube ä¸€æ¨£å±•ç¤º Instagram çŸ­å½±ç‰‡
- æ”¯æ´åˆ†é¡ç¯©é¸ï¼šå…¨éƒ¨ã€æœ€ç†±é–€ã€å½¢è±¡ã€å•†å“ã€è¶£å‘³
- éŸ¿æ‡‰å¼ç¶²æ ¼ä½ˆå±€ï¼Œé©é…å„ç¨®è¢å¹•å°ºå¯¸
- é»æ“Šæ’­æ”¾å…¨è¢å¹•å½±ç‰‡

### ğŸ¤– AI è—æ£§ç²¾éˆ + å•†å“æ¨è–¦
- **å¡”ç¾…å åœåŠŸèƒ½**ï¼šæä¾›æ„Ÿæƒ…ã€å·¥ä½œã€é‡‘éŒ¢ã€å®¶åº­ã€è‡ªæˆ‘æˆé•·ç­‰ä¸»é¡Œçš„å¡”ç¾…æŒ‡å¼•
- **å•†å“æ¨è–¦**ï¼šæ ¹æ“šå¡”ç¾…çµæœæ™ºèƒ½æ¨è–¦é©åˆçš„å•†å“
- **Function Calling**ï¼šæ•´åˆ OpenAI Assistant APIï¼Œæ”¯æ´å‹•æ…‹å•†å“æœå°‹èˆ‡æ¨è–¦
- **å°è©±é™æ™‚æ©Ÿåˆ¶**ï¼šæ¯æ¬¡å°è©±é™æ™‚ 180 ç§’ï¼Œè¶…æ™‚å¾Œéœ€ç­‰å¾… 5 åˆ†é˜å†·å»æœŸ
- **IP é–å®š**ï¼šåŸºæ–¼ IP åœ°å€çš„é™æµæ©Ÿåˆ¶ï¼Œé˜²æ­¢æ¿«ç”¨
- **æ™ºèƒ½å°è©±ä»‹é¢**ï¼šå‹•æ…‹å±•é–‹çš„èŠå¤©æ¡†ï¼Œå„ªåŒ–çš„ç”¨æˆ¶é«”é©—

### ğŸ›ï¸ å•†å“ç®¡ç†
- **Pinkoi å•†å“åŒæ­¥**ï¼šè‡ªå‹•å¾ Pinkoi å•†åº—åŒæ­¥å•†å“è³‡è¨Š
- **å•†å“å±•ç¤º**ï¼šæ”¯æ´åˆ†é¡ã€æ’åºã€åˆ†é ç€è¦½
- **å•†å“æ¨è–¦**ï¼šAI æ ¹æ“šç”¨æˆ¶éœ€æ±‚æ¨è–¦é©åˆçš„å•†å“
- **å¤šå¹³å°æ”¯æ´**ï¼šæ”¯æ´ Pinkoi å’Œè¦çš®å•†å“é€£çµ

### ğŸ“¸ ç©ºé–“å±•ç¤º
- å±•ç¤ºåº—å…§ç…§ç‰‡
- é»æ“Šæ”¾å¤§æŸ¥çœ‹

### ğŸ¨ é­”æ³•é¢¨æ ¼è¨­è¨ˆ
- æ·±è‰²ç¥ç§˜ä¸»é¡Œï¼Œå¸¶æœ‰é­”æ³•å…ƒç´ å’Œå‹•ç•«æ•ˆæœ
- éŸ¿æ‡‰å¼è¨­è¨ˆï¼Œé©é…æ‰‹æ©Ÿã€å¹³æ¿ã€æ¡Œé¢
- æµæš¢çš„å‹•ç•«éæ¸¡æ•ˆæœ

### ğŸ” å¾Œå°ç®¡ç†
- ç¨ç«‹å¾Œå°ç³»çµ±ï¼Œåˆ†é å¼ç®¡ç†ä»‹é¢
- **åª’é«”ç®¡ç†**ï¼šå½±ç‰‡ç®¡ç†ï¼ˆæ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤ã€åˆ†é¡ã€ç¸®åœ–ä¸Šå‚³ï¼‰
- **åœ–ç‰‡ç®¡ç†**ï¼šæ•…äº‹åœ–ç‰‡ä¸Šå‚³èˆ‡ç®¡ç†
- **å•†å“ç®¡ç†**ï¼šå•†å“åŒæ­¥ã€ç·¨è¼¯ã€åˆªé™¤åŠŸèƒ½
- **æœƒå“¡ç®¡ç†**ï¼šæœƒå“¡åˆ—è¡¨ã€ç‹€æ…‹ç®¡ç†ã€æœƒå“¡ç­‰ç´šè¨­å®šã€Email é©—è­‰ç®¡ç†
- **è¨ªå®¢çµ±è¨ˆ**ï¼šå®Œæ•´çš„ç¶²ç«™åˆ†æå„€è¡¨æ¿
  - ç¸½è¨ªå®¢æ•¸ã€æœƒè©±æ•¸ã€é é¢ç€è¦½æ•¸
  - å¹³å‡æœƒè©±æ™‚é•·ã€é é¢åœç•™æ™‚é–“
  - å³æ™‚åœ¨ç·šè¨ªå®¢æ•¸
  - ç†±é–€é é¢æ’è¡Œ
  - è£ç½®é¡å‹åˆ†å¸ƒ
  - æ–°è¨ªå®¢ vs å›è¨ªè€…åˆ†æ
- **æ–‡ä»¶ä¸Šå‚³è¦æ ¼**ï¼š
  - ç¸®åœ–ï¼šå»ºè­°å°ºå¯¸ 640x1136 åƒç´ ï¼Œæ¯”ä¾‹ç´„ç‚º 9:16ï¼ˆç›´å¼ï¼‰ï¼Œæœ€å¤§ 5MB
  - æ•…äº‹åœ–ç‰‡ï¼šå»ºè­°æ¯”ä¾‹ 1:1ï¼ˆæ­£æ–¹å½¢ï¼‰æˆ– 4:5ï¼ˆç›´å¼ï¼‰ï¼Œæœ€å¤§ 8MB
  - æ”¯æ´æ ¼å¼ï¼šJPEGã€PNGã€WebP

### ğŸ“± éŸ¿æ‡‰å¼å°èˆª
- æ¡Œé¢ç‰ˆï¼šç½®ä¸­å°èˆªé€£çµ
- æ‰‹æ©Ÿ/å¹³æ¿ç‰ˆï¼šå³å´æ¼¢å ¡é¸å–®

### ğŸ“„ Footer ç‰ˆæ¬Šå€å¡Š
- ç‰ˆæ¬Šè²æ˜ï¼šè‡ªå‹•é¡¯ç¤ºç•¶å‰å¹´ä»½
- è¯çµ¡ä¿¡ç®±ï¼šservice@showartz.comï¼ˆå¯é»æ“Šç™¼é€éƒµä»¶ï¼‰
- çµ±ä¸€çš„é­”æ³•é¢¨æ ¼è¨­è¨ˆ

## æŠ€è¡“æ£§

### å‰ç«¯
- **æ¡†æ¶**: Next.js 16.0.3 (App Router)
- **UI åº«**: React 19.2.0
- **æ¨£å¼**: Tailwind CSS 4
- **åœ–æ¨™**: Lucide React
- **ç‹€æ…‹ç®¡ç†**: React Hooks (useState, useEffect)

### å¾Œç«¯
- **API**: Next.js API Routes
- **è³‡æ–™åº«**: PostgreSQL
- **ORM**: åŸç”Ÿ pg é©…å‹•
- **èªè­‰**: è‡ªå®šç¾© Session ç®¡ç† (Base64 Cookie)
- **å¯†ç¢¼åŠ å¯†**: bcryptjs

### AI æ•´åˆ
- **OpenAI Assistant API**: GPT-4 æ¨¡å‹
- **Function Calling**: å•†å“æœå°‹èˆ‡æ¨è–¦åŠŸèƒ½
- **Thread ç®¡ç†**: å°è©±ä¸Šä¸‹æ–‡ç¶­è­·

### è³‡æ–™çˆ¬å–
- **Puppeteer**: ç¶²é çˆ¬èŸ²ï¼ˆPinkoi å•†å“åŒæ­¥ï¼‰
- **Axios**: HTTP è«‹æ±‚

### éƒ¨ç½²
- **å®¹å™¨åŒ–**: Docker + Docker Compose
- **åå‘ä»£ç†**: Nginx (å¯é¸)

## Logging & Diagnostics
- ä¸»è¦ä¾†æºï¼š`docker-compose logs app/postgres`ï¼Œä»¥åŠéƒ¨ç½²/ä¿®å¾©è…³æœ¬ï¼ˆå¦‚ `deploy-and-fix.sh`ã€`fix-502.sh`ã€`diagnose-502.sh`ï¼‰çš„çµ‚ç«¯è¼¸å‡ºã€‚
- å…§å®¹é¡åˆ¥ï¼šæ‡‰ç”¨å•Ÿå‹•èˆ‡å¥åº·æª¢æŸ¥ã€API è«‹æ±‚éŒ¯èª¤å †ç–Šã€çˆ¬èŸ²/åŒæ­¥æ—¥èªŒã€è³‡æ–™åº«å¥åº·ç‹€æ…‹ã€‚
- è¼ªè½‰/å®¹é‡ï¼šDocker `json-file`ï¼Œ`max-size=10m`ã€`max-file=3`ï¼›éœ€è¦æ›´é•·æœŸä¿ç•™æ™‚å¯åŠ  logrotate æˆ–é›†ä¸­å¼æ—¥èªŒã€‚
- æ•æ„Ÿè³‡è¨Šï¼šä¸å¾—è¨˜éŒ„ API Key/å¯†ç¢¼ç­‰æ©Ÿå¯†ï¼›è‹¥éœ€èª¿è©¦ï¼Œè«‹è„«æ•å¾Œå†è¼¸å‡ºï¼Œé¿å…åœ¨ç¨‹å¼ä¸­ `console.log` æ©Ÿå¯†ã€‚
- å¥åº·æª¢æŸ¥ï¼š`/api/health` å¯ä½œå­˜æ´»æª¢æŸ¥ï¼ˆè‹¥éœ€ç´” JSON å›æ‡‰å¯å†èª¿æ•´æ ¼å¼ï¼‰ã€‚

## Scripts ä¸€è¦½èˆ‡æ­¸æª”è¦å‰‡
- ä¿ç•™/å¸¸ç”¨ï¼š
  - `scripts/deploy-and-fix.sh`ï¼šä¸€éµéƒ¨ç½² + ä¿®å¾©
  - `scripts/fix-502.sh`ã€`scripts/diagnose-502.sh`ï¼š502 ä¿®å¾©/è¨ºæ–·
  - `scripts/monitor-and-restart.sh`ï¼šå¯åŠ å…¥ cron å®šæœŸæª¢æŸ¥ä¸¦è‡ªå‹•é‡å•Ÿ
  - `scripts/deploy-production.sh`ï¼šæ­£å¼ç’°å¢ƒéƒ¨ç½²
  - åˆå§‹åŒ–/ç¶­è­·ï¼š`create-admin.mjs`ã€`init-db.mjs`ã€`reset-admin-password.mjs`ã€`migrate-pinkoi.mjs`ã€`add-product-tags.mjs`
- å·²æ­¸æª”è‡³ `scripts/archive/`ï¼ˆä¸å¸¸ç”¨/é‡è¤‡ï¼‰ï¼š`deploy-remote.sh`ã€`deploy-to-vultr.sh`ã€`deploy-vultr.sh`ã€`redeploy-vultr.sh`ã€`check-env-vultr.sh`ã€`fix-env-vultr.sh`ã€`setup-ssl-vultr.sh`ã€`test-shopee-direct.mjs`ã€`test-shopee-scraper.mjs`ã€`DIRECT_FIX_COMMANDS.sh`
- è¦å‰‡ï¼š
  - å¸¸ç”¨è…³æœ¬æ”¾ `scripts/`
  - æ­·å²/ä¸€æ¬¡æ€§/é‡è¤‡è…³æœ¬ç§» `scripts/archive/`
  - æ–°å¢è…³æœ¬è«‹åœ¨ README æœ¬ç¯€è£œå……ç”¨é€”èˆ‡ä¾è³´ï¼ˆå«ç’°å¢ƒè®Šæ•¸ï¼‰

## Documentation / README è¦å‰‡
- ä¸» READMEï¼šå¿«é€Ÿä¸Šæ‰‹ã€éƒ¨ç½²ã€æ—¥èªŒ/ç›£æ§è¦å‰‡ã€æŠ€è¡“æ£§èˆ‡ API æ‘˜è¦ã€‚
- å°ˆé¡Œæ–‡æª”ï¼š
  - `readme/`ï¼šAssistant é…ç½®ã€æç¤ºè©ã€å·¥å…· schema
  - `docs/` æˆ– `ops/`ï¼ˆå¯è¦–éœ€æ±‚å»ºç«‹ï¼‰ï¼šéƒ¨ç½²/æ•…éšœæ’é™¤ï¼Œå¦‚ `DEPLOY_FIX_502.md`ã€`FIX_502_ANALYSIS.md`ã€`QUICK_FIX.md`
- å»ºè­°æ¯ä»½æ–‡æª”é–‹é ­åŒ…å«ï¼šç›®çš„ã€é©ç”¨ç’°å¢ƒã€æ­¥é©Ÿ/å‘½ä»¤ã€æœŸæœ›è¼¸å‡ºã€é¢¨éšª/æ³¨æ„äº‹é …ã€æ›´æ–°æ—¥æœŸã€‚

## æ–‡æª”ç´¢å¼•
- æ ¹ç›®éŒ„ï¼š`README.md`ï¼ˆç¸½è¦½èˆ‡å…¥å£ï¼‰ã€`QUICKSTART.md`ï¼ˆå¿«é€Ÿé–‹å§‹ï¼‰ã€`SETUP_ENV.md`ï¼ˆç’°å¢ƒè¨­å®šï¼‰ã€‚
- docs/ï¼šåˆ†æèˆ‡æœ€ä½³åŒ–å ±å‘Šï¼ˆå¦‚ `ANALYSIS_REPORT.md`ã€`OPTIMIZATION_REPORT.md`ã€`SYSTEM_OPTIMIZATION_REPORT.md`ï¼‰ã€‚
- docs/ops/ï¼šéƒ¨ç½²èˆ‡æ•…éšœæ’é™¤ï¼Nginxï¼502 ä¿®å¾©ï¼ˆå¦‚ `DEPLOY_FIX_502.md`ã€`FIX_502_ANALYSIS.md`ã€`QUICK_FIX.md`ã€`DEPLOY_LATEST.md`ã€`DEPLOY_STEPS.md`ã€`DEPLOY_VULTR.md`ã€`DEPLOYMENT_STATUS.md`ã€`VULTR_QUICK_START.md`ã€`NGINX_CONFIG.md`ã€`NGINX_UPLOADS_FIX.md`ï¼‰ã€‚
- readme/ï¼šAssistant/AI å°ˆé¡Œæ–‡æª”èˆ‡æç¤ºè©ï¼ˆå¦‚ `OpenAI Assistant é…ç½®æŒ‡å—.md`ã€`å‰µå»ºæ–°çš„ Assistant.md`ã€`showartz Tarot é¡§å•ï¼‹å•†å“æ¨è–¦åŠ©ç†æç¤ºè©`ã€`showartz_product_tools_schema.json`ï¼‰ã€‚
- è¦å‰‡ï¼šæ–°å¢æ–‡æª”è«‹ä¾ä¸»é¡Œæ”¾åˆ°å°æ‡‰ç›®éŒ„ï¼Œä¸¦åœ¨æœ¬ç´¢å¼•è£œä¸Šä¸€è¡Œç”¨é€”æè¿°ã€‚

## ç³»çµ±æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ç”¨æˆ¶ç€è¦½å™¨ (Browser)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Next.js æ‡‰ç”¨ (Port 3001)        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  å‰ç«¯é é¢     â”‚   API Routes     â”‚   â”‚
â”‚  â”‚  - é¦–é       â”‚  - /api/search   â”‚   â”‚
â”‚  â”‚  - å•†å“é     â”‚  - /api/products â”‚   â”‚
â”‚  â”‚  - å¾Œå°      â”‚  - /api/pinkoi   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL  â”‚  â”‚  OpenAI API  â”‚
â”‚  (Port 5432)  â”‚  â”‚  (External)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## é–‹ç™¼è¦æ ¼

### 1. èŠå¤©é™æ™‚æ©Ÿåˆ¶ (`lib/chat-limiter.ts`)

**åŠŸèƒ½**ï¼š
- æ¯æ¬¡å°è©±é™æ™‚ 180 ç§’
- è¶…æ™‚å¾Œé€²å…¥ 300 ç§’ï¼ˆ5 åˆ†é˜ï¼‰å†·å»æœŸ
- åŸºæ–¼ IP åœ°å€çš„é™æµ
- è‡ªå‹•æ¸…ç†éæœŸç‹€æ…‹

**å¯¦ä½œç´°ç¯€**ï¼š
- ä½¿ç”¨å…§å­˜ Map å­˜å„² IP ç‹€æ…‹ï¼ˆç”Ÿç”¢ç’°å¢ƒå»ºè­°ä½¿ç”¨ Redisï¼‰
- æ¯ 10 åˆ†é˜è‡ªå‹•æ¸…ç†éæœŸè¨˜éŒ„
- æ”¯æ´å¾å¤šç¨® HTTP headers ç²å– IPï¼ˆx-forwarded-for, x-real-ip, cf-connecting-ipï¼‰

**API å›æ‡‰**ï¼š
- 429 ç‹€æ…‹ç¢¼ï¼šé™æ™‚/å†·å»éŒ¯èª¤
- éŒ¯èª¤è¨Šæ¯ï¼šã€ŒæŠ±æ­‰ï¼Œç›®å‰æˆ‘çš„å°è©±æ™‚é–“æœ‰é™æ™‚ï¼Œè«‹æ‚¨ç­‰å€™5åˆ†é˜å¾Œå†èˆ‡æˆ‘èŠèŠã€‚ã€

### 2. OpenAI Assistant æ•´åˆ

**Function Calling å·¥å…·**ï¼š
- `recommend_products`: æ ¹æ“šæ¢ä»¶æ¨è–¦å•†å“
- `search_products_by_tags`: æ ¹æ“šæ¨™ç±¤æœå°‹å•†å“
- `get_all_products`: å–å¾—æ‰€æœ‰å•†å“åˆ—è¡¨

**æç¤ºè©ç®¡ç†**ï¼š
- ä½ç½®ï¼š`readme/showartz Tarot é¡§å•ï¼‹å•†å“æ¨è–¦åŠ©ç†æç¤ºè©`
- JSON Schemaï¼š`readme/showartz_product_tools_schema.json`
- é…ç½®æŒ‡å—ï¼š`readme/OpenAI Assistant é…ç½®æŒ‡å—.md`

### 3. å•†å“åŒæ­¥ç³»çµ±

**Pinkoi åŒæ­¥** (`lib/pinkoi-sync.ts`):
- API å„ªå…ˆï¼šå˜—è©¦ä½¿ç”¨ Pinkoi API ç²å–å•†å“
- çˆ¬èŸ²å‚™æ´ï¼šAPI å¤±æ•—æ™‚ä½¿ç”¨ Puppeteer çˆ¬å–
- åœ–ç‰‡è™•ç†ï¼šè‡ªå‹•æå–å•†å“åœ–ç‰‡ URL
- è³‡æ–™é©—è­‰ï¼šæª¢æŸ¥é‡è¤‡å•†å“ï¼ˆåŸºæ–¼ itemIdï¼‰

**API ç«¯é»**ï¼š
- `POST /api/pinkoi/sync`: æ‰‹å‹•è§¸ç™¼åŒæ­¥
- `GET /api/pinkoi/sync`: æŸ¥è©¢åŒæ­¥ç‹€æ…‹

### 4. éŸ¿æ‡‰å¼å°èˆª

**æ¡Œé¢ç‰ˆ**ï¼š
- Logo åœ¨å·¦å´
- å°èˆªé€£çµç½®ä¸­
- å³å´ç©ºç™½å€åŸŸå¹³è¡¡ä½ˆå±€

**æ‰‹æ©Ÿ/å¹³æ¿ç‰ˆ**ï¼š
- Logo åœ¨å·¦å´
- å³å´æ¼¢å ¡é¸å–®æŒ‰éˆ•
- å…¨è¢å¹•ä¸‹æ‹‰é¸å–®
- è‡ªå‹•é—œé–‰ï¼ˆè·¯ç”±æ”¹è®Šæ™‚ï¼‰

### 5. é¦–é å‹•æ…‹å…§å®¹

**é‚è¼¯**ï¼š
- é è¨­é¡¯ç¤º IG å½±ç‰‡ç¶²æ ¼
- ç•¶ AI æ¨è–¦å•†å“æ™‚ï¼Œè‡ªå‹•åˆ‡æ›é¡¯ç¤ºå•†å“ç¶²æ ¼
- é›¢é–‹èŠå¤©æ™‚æ¢å¾©é¡¯ç¤ºå½±ç‰‡ç¶²æ ¼

**çµ„ä»¶**ï¼š
- `SearchAgent`: èŠå¤©ä»‹é¢ï¼Œæ”¯æ´å‹•æ…‹å±•é–‹
- `VideoGrid`: IG å½±ç‰‡ç¶²æ ¼
- `ProductGrid`: å•†å“ç¶²æ ¼

## é–‹ç™¼éç¨‹

### Phase 1: åŸºç¤æ¶æ§‹å»ºç«‹
1. âœ… Next.js 16 å°ˆæ¡ˆåˆå§‹åŒ–
2. âœ… PostgreSQL è³‡æ–™åº«è¨­è¨ˆèˆ‡åˆå§‹åŒ–
3. âœ… åŸºç¤é é¢çµæ§‹ï¼ˆé¦–é ã€å•†å“ã€æ•…äº‹ã€é—œæ–¼ï¼‰
4. âœ… å¾Œå°ç®¡ç†ç³»çµ±

### Phase 2: IG å½±ç‰‡åŠŸèƒ½
1. âœ… å½±ç‰‡è³‡æ–™è¡¨è¨­è¨ˆ
2. âœ… å½±ç‰‡ CRUD API
3. âœ… å½±ç‰‡å±•ç¤ºçµ„ä»¶
4. âœ… åˆ†é¡ç¯©é¸åŠŸèƒ½
5. âœ… å…¨è¢å¹•æ’­æ”¾å™¨

### Phase 3: OpenAI æ•´åˆ
1. âœ… OpenAI Assistant API æ•´åˆ
2. âœ… Function Calling å¯¦ä½œ
3. âœ… å•†å“æ¨è–¦é‚è¼¯
4. âœ… å°è©±ä¸Šä¸‹æ–‡ç®¡ç†ï¼ˆThreadï¼‰
5. âœ… JSON metadata æ¸…ç†

### Phase 4: å•†å“ç®¡ç†
1. âœ… å•†å“è³‡æ–™è¡¨è¨­è¨ˆ
2. âœ… Pinkoi çˆ¬èŸ²é–‹ç™¼
3. âœ… å•†å“åŒæ­¥ API
4. âœ… å•†å“å±•ç¤ºé é¢
5. âœ… å•†å“æ¨è–¦æ•´åˆ

### Phase 5: UI/UX å„ªåŒ–
1. âœ… éŸ¿æ‡‰å¼å°èˆªï¼ˆæ¼¢å ¡é¸å–®ï¼‰
2. âœ… èŠå¤©ä»‹é¢å‹•æ…‹å±•é–‹
3. âœ… é¦–é å…§å®¹å‹•æ…‹åˆ‡æ›
4. âœ… é–“è·èˆ‡ä½ˆå±€èª¿æ•´
5. âœ… æ­¡è¿è©èˆ‡æç¤ºæ–‡å­—å„ªåŒ–

### Phase 6: é™æµæ©Ÿåˆ¶
1. âœ… IP è¿½è¹¤ç³»çµ±
2. âœ… å°è©±é™æ™‚æ©Ÿåˆ¶ï¼ˆ180 ç§’ï¼‰
3. âœ… å†·å»æœŸæ©Ÿåˆ¶ï¼ˆ300 ç§’ï¼‰
4. âœ… éŒ¯èª¤è™•ç†èˆ‡ç”¨æˆ¶æç¤º

### Phase 7: UI/UX æœ€çµ‚å„ªåŒ–
1. âœ… èŠå¤©å®¤æ¨™é¡Œæ›´æ–°ç‚ºã€Œè—æ£§ç²¾éˆã€
2. âœ… Footer çµ„ä»¶å¯¦ä½œï¼ˆç‰ˆæ¬Šè²æ˜ + è¯çµ¡ä¿¡ç®±ï¼‰
3. âœ… é é¢æ¨™é¡Œèˆ‡å°èˆªé–“è·å„ªåŒ–ï¼ˆæ•…äº‹ã€å•†å“ã€é—œæ–¼é é¢ï¼‰
4. âœ… æœå°‹å·¥å…·å¯¬åº¦èª¿æ•´ï¼ˆéŸ¿æ‡‰å¼å¯¬åº¦å„ªåŒ–ï¼‰
5. âœ… é¦–é å…§å®¹å€åŸŸé–“è·èª¿æ•´
6. âœ… åˆ†é¡æŒ‰éˆ•é–“è·å„ªåŒ–
7. âœ… æœå‹™é …ç›®èˆ‡ Footer é–“è·èª¿æ•´

### Phase 8: å‰ç«¯è¨­è¨ˆèª¿æ•´èˆ‡æ–°åŠŸèƒ½ (v1.1.0)
1. âœ… **å‰ç«¯è¨­è¨ˆå„ªåŒ–**ï¼šç°¡æ½”ä¿è½çš„ç¾ä»£åŒ– UI é¢¨æ ¼
   - çµ±ä¸€é–“è·èˆ‡ä½ˆå±€è¨­è¨ˆ
   - å„ªåŒ–è‰²å½©æ­é…èˆ‡è¦–è¦ºå±¤æ¬¡
   - æ”¹é€²éŸ¿æ‡‰å¼è¨­è¨ˆé«”é©—
2. âœ… **è¨ªå®¢çµ±è¨ˆç³»çµ±**ï¼šå®Œæ•´çš„ç¶²ç«™åˆ†æåŠŸèƒ½
   - è³‡æ–™åº«è¨­è¨ˆï¼šsessionsã€page_viewsã€visitors è¡¨
   - å‰ç«¯è¿½è¹¤ï¼šAnalytics çµ„ä»¶è‡ªå‹•è¨˜éŒ„è¨ªå®¢è¡Œç‚º
   - å¾Œå°å„€è¡¨æ¿ï¼šAnalyticsDashboard çµ„ä»¶é¡¯ç¤ºçµ±è¨ˆæ•¸æ“š
   - API ç«¯é»ï¼š`/api/analytics/stats` æä¾›çµ±è¨ˆæ•¸æ“š
   - æ”¯æ´æ™‚é–“ç¯„åœç¯©é¸ï¼šä»Šå¤©ã€æœ¬é€±ã€æœ¬æœˆ
3. âœ… **æœƒå“¡ç®¡ç†ç³»çµ±**ï¼šå¾Œå°æœƒå“¡ç®¡ç†åŠŸèƒ½
   - æœƒå“¡åˆ—è¡¨é¡¯ç¤ºï¼šå§“åã€Emailã€ç‹€æ…‹ã€æœƒå“¡ç­‰ç´šã€ç©åˆ†ã€æ¶ˆè²»é‡‘é¡
   - ç‹€æ…‹ç®¡ç†ï¼šå•Ÿç”¨ã€åœç”¨ã€æš«åœ
   - æœƒå“¡ç­‰ç´šï¼šä¸€èˆ¬æœƒå“¡ã€é«˜ç´šæœƒå“¡ã€VIP æœƒå“¡
   - Email é©—è­‰ç®¡ç†ï¼šæ‰‹å‹•è¨­å®šé©—è­‰ç‹€æ…‹
   - ç¯©é¸åŠŸèƒ½ï¼šä¾ç‹€æ…‹å’Œæœƒå“¡ç­‰ç´šç¯©é¸
   - çµ±è¨ˆè³‡è¨Šï¼šç¸½æœƒå“¡æ•¸ã€å•Ÿç”¨æœƒå“¡æ•¸ã€VIP æœƒå“¡æ•¸ã€ç¸½æ¶ˆè²»é‡‘é¡
   - API ç«¯é»ï¼š`/api/admin/users` æä¾› CRUD æ“ä½œ
4. âœ… **ç³»çµ±å„ªåŒ–è¨ˆåŠƒ**ï¼šå®Œæ•´çš„å„ªåŒ–åˆ†æå ±å‘Š
   - é«˜å„ªå…ˆç´šå„ªåŒ–ï¼šæ•¸æ“šåº«æŸ¥è©¢å„ªåŒ–ã€æ—¥èªŒç®¡ç†ã€å‰ç«¯æ€§èƒ½å„ªåŒ–
   - ä¸­å„ªå…ˆç´šå„ªåŒ–ï¼šAPI ç·©å­˜ã€éŒ¯èª¤è™•ç†çµ±ä¸€ã€è¼¸å…¥é©—è­‰
   - ä½å„ªå…ˆç´šå„ªåŒ–ï¼šä»£ç¢¼é‡è¤‡æ¶ˆé™¤ã€é¡å‹å®‰å…¨æ”¹é€²ã€æ‰¹é‡æ“ä½œå„ªåŒ–
   - è©³ç´°å ±å‘Šï¼š`docs/SYSTEM_OPTIMIZATION_REPORT.md`

### Phase 9: æ€§èƒ½å„ªåŒ–å¯¦æ–½ (v1.1.1)
1. âœ… **API éŸ¿æ‡‰ç·©å­˜æ©Ÿåˆ¶**
   - å•†å“åˆ—è¡¨ APIï¼šä½¿ç”¨ Next.js `unstable_cache`ï¼Œ60 ç§’ç·©å­˜
   - å½±ç‰‡åˆ—è¡¨ APIï¼šåŒæ¨£å¯¦æ–½ç·©å­˜æ©Ÿåˆ¶
   - é æœŸæ•ˆæœï¼šéŸ¿æ‡‰æ™‚é–“æ¸›å°‘ 70-90%ï¼ˆç·©å­˜å‘½ä¸­æ™‚ï¼‰ï¼Œæ•¸æ“šåº«è² è¼‰é™ä½ 80%+
2. âœ… **Analytics Stats API æŸ¥è©¢å„ªåŒ–**
   - å°‡ 9 å€‹ç¨ç«‹æŸ¥è©¢åˆä½µç‚º 1 å€‹ CTEï¼ˆCommon Table Expressionï¼‰æŸ¥è©¢
   - ä½¿ç”¨åƒæ•¸åŒ–æŸ¥è©¢ï¼Œæ¶ˆé™¤ SQL æ³¨å…¥é¢¨éšª
   - æ¶ˆé™¤é‡è¤‡çš„å­æŸ¥è©¢è¨ˆç®—
   - é æœŸæ•ˆæœï¼šæŸ¥è©¢æ™‚é–“æ¸›å°‘ 60-80%ï¼Œæ•¸æ“šåº«è² è¼‰å¤§å¹…é™ä½
3. âœ… **æ—¥èªŒç®¡ç†å·¥å…·**
   - å‰µå»º `lib/logger.ts` çµ±ä¸€æ—¥èªŒç³»çµ±
   - æ ¹æ“šç’°å¢ƒè®Šæ•¸ `LOG_LEVEL` æ§åˆ¶æ—¥èªŒè¼¸å‡ºç´šåˆ¥
   - ç”Ÿç”¢ç’°å¢ƒé è¨­åªè¼¸å‡ºéŒ¯èª¤æ—¥èªŒ
   - é æœŸæ•ˆæœï¼šç”Ÿç”¢ç’°å¢ƒæ—¥èªŒæ¸›å°‘ 80%+ï¼Œæ€§èƒ½æå‡ 5-10%
4. âœ… **å‰ç«¯çµ„ä»¶æ€§èƒ½å„ªåŒ–**
   - UserManager çµ„ä»¶ï¼šä½¿ç”¨ `useMemo` å’Œ `useCallback` å„ªåŒ–
   - ç·©å­˜ç¯©é¸çµæœå’Œçµ±è¨ˆè³‡è¨Šè¨ˆç®—
   - é æœŸæ•ˆæœï¼šçµ„ä»¶é‡æ¸²æŸ“æ¸›å°‘ 30-50%ï¼Œé é¢éŸ¿æ‡‰é€Ÿåº¦æå‡
5. âœ… **éŒ¯èª¤ä¿®å¾©**
   - ä¿®å¾© Analytics Stats API SQL æŸ¥è©¢èªæ³•éŒ¯èª¤
   - ä¿®å¾© Pageview API åƒæ•¸è™•ç†å’Œæ•¸æ“šåº«è¡¨è‡ªå‹•å‰µå»º
   - ä¿®å¾© UserManager çµ„ä»¶é‡è¤‡å®šç¾©å•é¡Œ

## ç’°å¢ƒè¨­å®š

### å¿…è¦ç’°å¢ƒè®Šæ•¸

å»ºç«‹ `.env.local` æª”æ¡ˆï¼š

```env
# OpenAI è¨­å®š
OPENAI_API_KEY=your_openai_api_key
OPENAI_ASSISTANT_ID=your_assistant_id

# è³‡æ–™åº«è¨­å®š
DATABASE_URL=postgresql://user:password@localhost:5432/showartz

# Session è¨­å®š
SESSION_SECRET=your_random_secret_here

# ç®¡ç†å“¡å¸³è™Ÿ
ADMIN_USERNAME=admin
ADMIN_PASSWORD=your_password
```

### è³‡æ–™åº«åˆå§‹åŒ–

```bash
npm run init-db
```

é€™æœƒï¼š
- å»ºç«‹æ‰€æœ‰å¿…è¦çš„è³‡æ–™è¡¨
- å»ºç«‹ç®¡ç†å“¡å¸³è™Ÿ
- è¨­å®šåˆå§‹è³‡æ–™çµæ§‹

## æœ¬åœ°é–‹ç™¼

### 1. å®‰è£ä¾è³´

```bash
npm install
```

### 2. å•Ÿå‹•è³‡æ–™åº«

ä½¿ç”¨ Dockerï¼š
```bash
docker-compose up -d postgres
```

æˆ–ä½¿ç”¨æœ¬åœ° PostgreSQLï¼š
```bash
createdb showartz
```

### 3. åˆå§‹åŒ–è³‡æ–™åº«

```bash
npm run init-db
```

### 4. å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨

```bash
npm run dev
```

ç¶²ç«™å°‡åœ¨ http://localhost:3001 é–‹å•Ÿ

### 5. è¨ªå•å¾Œå°

- ç¶²å€ï¼šhttp://localhost:3001/admin
- é è¨­å¸³è™Ÿï¼šadmin
- é è¨­å¯†ç¢¼ï¼šadmin123ï¼ˆæˆ–åœ¨ `.env.local` ä¸­è¨­å®šï¼‰

## API æ–‡æª”

### èŠå¤© API

**POST /api/search**
- åŠŸèƒ½ï¼šç™¼é€è¨Šæ¯çµ¦ AI åŠ©æ‰‹
- è«‹æ±‚é«”ï¼š
  ```json
  {
    "message": "ç”¨æˆ¶è¨Šæ¯",
    "threadId": "thread_id (å¯é¸)"
  }
  ```
- å›æ‡‰ï¼š
  ```json
  {
    "response": "AI å›æ‡‰",
    "threadId": "thread_id",
    "recommendedProducts": [...]
  }
  ```
- éŒ¯èª¤ï¼š
  - 429: é™æ™‚/å†·å»éŒ¯èª¤
  - 500: ä¼ºæœå™¨éŒ¯èª¤

### å•†å“ API

**GET /api/products**
- åŠŸèƒ½ï¼šå–å¾—æ‰€æœ‰å•†å“åˆ—è¡¨
- å›æ‡‰ï¼šå•†å“é™£åˆ—

**GET /api/products/[id]**
- åŠŸèƒ½ï¼šå–å¾—å–®ä¸€å•†å“
- å›æ‡‰ï¼šå•†å“ç‰©ä»¶

**POST /api/products/recommend**
- åŠŸèƒ½ï¼šæ ¹æ“šæ¢ä»¶æ¨è–¦å•†å“
- è«‹æ±‚é«”ï¼š
  ```json
  {
    "budget": 1000,
    "category": "å¾ŒèƒŒåŒ…",
    "tags": ["è²“é ­é·¹", "é»‘è‰²"],
    "goal": "æƒ…ç·’ç©©å®š",
    "limit": 5
  }
  ```

### Pinkoi åŒæ­¥ API

**POST /api/pinkoi/sync**
- åŠŸèƒ½ï¼šæ‰‹å‹•è§¸ç™¼å•†å“åŒæ­¥
- æ¬Šé™ï¼šéœ€è¦ç®¡ç†å“¡ç™»å…¥
- å›æ‡‰ï¼š
  ```json
  {
    "success": true,
    "total": 10,
    "success": 10,
    "failed": 0
  }
  ```

**GET /api/pinkoi/sync**
- åŠŸèƒ½ï¼šæŸ¥è©¢åŒæ­¥ç‹€æ…‹
- å›æ‡‰ï¼šåŒæ­¥ç‹€æ…‹è³‡è¨Š

### è¨ªå®¢çµ±è¨ˆ API

**GET /api/analytics/stats**
- åŠŸèƒ½ï¼šå–å¾—ç¶²ç«™çµ±è¨ˆæ•¸æ“š
- æ¬Šé™ï¼šéœ€è¦ç®¡ç†å“¡ç™»å…¥
- æŸ¥è©¢åƒæ•¸ï¼š
  - `period`: æ™‚é–“ç¯„åœ (today, week, month)
- å›æ‡‰ï¼š
  ```json
  {
    "totalVisitors": 100,
    "totalSessions": 150,
    "totalPageViews": 300,
    "avgSessionDuration": 180,
    "avgPageDuration": 60,
    "activeVisitors": 5,
    "popularPages": [...],
    "deviceTypes": [...],
    "visitorTypes": [...]
  }
  ```

**POST /api/analytics/pageview**
- åŠŸèƒ½ï¼šè¨˜éŒ„é é¢ç€è¦½ï¼ˆå‰ç«¯è‡ªå‹•èª¿ç”¨ï¼‰
- è«‹æ±‚é«”ï¼š
  ```json
  {
    "pagePath": "/products",
    "referrer": "https://showartz.com"
  }
  ```

**POST /api/analytics/pageview/exit**
- åŠŸèƒ½ï¼šè¨˜éŒ„é é¢é›¢é–‹ï¼ˆå‰ç«¯è‡ªå‹•èª¿ç”¨ï¼‰
- è«‹æ±‚é«”ï¼š
  ```json
  {
    "pagePath": "/products",
    "duration": 60,
    "scrollDepth": 75
  }
  ```

**POST /api/analytics/session/end**
- åŠŸèƒ½ï¼šçµæŸæœƒè©±ï¼ˆå‰ç«¯è‡ªå‹•èª¿ç”¨ï¼‰
- è«‹æ±‚é«”ï¼š
  ```json
  {
    "sessionId": "uuid",
    "duration": 180
  }
  ```

### æœƒå“¡ç®¡ç† API

**GET /api/admin/users**
- åŠŸèƒ½ï¼šå–å¾—æ‰€æœ‰æœƒå“¡åˆ—è¡¨
- æ¬Šé™ï¼šéœ€è¦ç®¡ç†å“¡ç™»å…¥
- å›æ‡‰ï¼šæœƒå“¡é™£åˆ—

**PUT /api/admin/users**
- åŠŸèƒ½ï¼šæ›´æ–°æœƒå“¡ç‹€æ…‹ã€æœƒå“¡ç­‰ç´šã€Email é©—è­‰ç‹€æ…‹
- æ¬Šé™ï¼šéœ€è¦ç®¡ç†å“¡ç™»å…¥
- è«‹æ±‚é«”ï¼š
  ```json
  {
    "userId": "uuid",
    "status": "active",
    "membership_level": "vip",
    "email_verified": true
  }
  ```

**DELETE /api/admin/users?userId=uuid**
- åŠŸèƒ½ï¼šåˆªé™¤æœƒå“¡ï¼ˆåŒæ™‚åˆªé™¤ç›¸é—œåœ°å€è³‡æ–™ï¼‰
- æ¬Šé™ï¼šéœ€è¦ç®¡ç†å“¡ç™»å…¥
- å›æ‡‰ï¼š
  ```json
  {
    "success": true,
    "message": "User deleted successfully"
  }
  ```

## è³‡æ–™åº«çµæ§‹

### videos è¡¨
- `id`: UUID (ä¸»éµ)
- `ig_url`: Instagram å½±ç‰‡ URL
- `title`: æ¨™é¡Œ
- `category`: åˆ†é¡ (hot, image, product, fun)
- `order_index`: æ’åºç´¢å¼•
- `created_at`: å»ºç«‹æ™‚é–“
- `updated_at`: æ›´æ–°æ™‚é–“

### images è¡¨
- `id`: UUID (ä¸»éµ)
- `image_url`: åœ–ç‰‡ URL
- `description`: æè¿°
- `created_at`: å»ºç«‹æ™‚é–“

### products è¡¨
- `id`: UUID (ä¸»éµ)
- `item_id`: å•†å“ IDï¼ˆPinkoi/Shopeeï¼‰
- `name`: å•†å“åç¨±
- `price`: åƒ¹æ ¼
- `original_price`: åŸåƒ¹
- `image_url`: åœ–ç‰‡ URL
- `description`: æè¿°
- `category`: åˆ†é¡
- `tags`: æ¨™ç±¤ï¼ˆJSON é™£åˆ—ï¼‰
- `pinkoi_url`: Pinkoi é€£çµ
- `shopee_url`: è¦çš®é€£çµ
- `sales_count`: éŠ·å”®é‡
- `rating`: è©•åˆ†
- `created_at`: å»ºç«‹æ™‚é–“
- `updated_at`: æ›´æ–°æ™‚é–“

### admin_users è¡¨
- `id`: UUID (ä¸»éµ)
- `username`: ä½¿ç”¨è€…åç¨±
- `password_hash`: å¯†ç¢¼é›œæ¹Š
- `created_at`: å»ºç«‹æ™‚é–“

### users è¡¨ï¼ˆæœƒå“¡è¡¨ï¼‰
- `id`: UUID (ä¸»éµ)
- `email`: Email åœ°å€ï¼ˆå”¯ä¸€ï¼‰
- `password_hash`: å¯†ç¢¼é›œæ¹Š
- `name`: å§“å
- `nickname`: æš±ç¨±
- `avatar_url`: é ­åƒ URL
- `email_verified`: Email æ˜¯å¦é©—è­‰
- `status`: ç‹€æ…‹ (active, inactive, suspended)
- `membership_level`: æœƒå“¡ç­‰ç´š (regular, premium, vip)
- `total_points`: ç¸½ç©åˆ†
- `total_spent`: ç¸½æ¶ˆè²»é‡‘é¡
- `created_at`: å»ºç«‹æ™‚é–“
- `updated_at`: æ›´æ–°æ™‚é–“
- `last_login_at`: æœ€å¾Œç™»å…¥æ™‚é–“

### addresses è¡¨ï¼ˆåœ°å€è¡¨ï¼‰
- `id`: UUID (ä¸»éµ)
- `user_id`: ç”¨æˆ¶ IDï¼ˆå¤–éµï¼‰
- `name`: æ”¶ä»¶äººå§“å
- `phone`: é›»è©±è™Ÿç¢¼
- `address_line1`: åœ°å€ç¬¬ä¸€è¡Œ
- `address_line2`: åœ°å€ç¬¬äºŒè¡Œï¼ˆå¯é¸ï¼‰
- `city`: åŸå¸‚
- `postal_code`: éƒµéå€è™Ÿ
- `country`: åœ‹å®¶
- `is_default`: æ˜¯å¦ç‚ºé è¨­åœ°å€
- `created_at`: å»ºç«‹æ™‚é–“

### sessions è¡¨ï¼ˆæœƒè©±è¡¨ï¼‰
- `id`: UUID (ä¸»éµ)
- `visitor_id`: è¨ªå®¢ ID
- `started_at`: æœƒè©±é–‹å§‹æ™‚é–“
- `ended_at`: æœƒè©±çµæŸæ™‚é–“
- `duration_seconds`: æœƒè©±æŒçºŒæ™‚é–“ï¼ˆç§’ï¼‰
- `device_type`: è£ç½®é¡å‹ (desktop, mobile, tablet)
- `browser`: ç€è¦½å™¨åç¨±
- `os`: ä½œæ¥­ç³»çµ±

### page_views è¡¨ï¼ˆé é¢ç€è¦½è¡¨ï¼‰
- `id`: UUID (ä¸»éµ)
- `session_id`: æœƒè©± IDï¼ˆå¤–éµï¼‰
- `visitor_id`: è¨ªå®¢ ID
- `page_path`: é é¢è·¯å¾‘
- `entered_at`: é€²å…¥æ™‚é–“
- `exited_at`: é›¢é–‹æ™‚é–“
- `duration_seconds`: é é¢åœç•™æ™‚é–“ï¼ˆç§’ï¼‰
- `scroll_depth`: æ»¾å‹•æ·±åº¦ï¼ˆ0-100ï¼‰

### visitors è¡¨ï¼ˆè¨ªå®¢è¡¨ï¼‰
- `visitor_id`: è¨ªå®¢ IDï¼ˆä¸»éµï¼‰
- `first_seen_at`: é¦–æ¬¡è¨ªå•æ™‚é–“
- `last_seen_at`: æœ€å¾Œè¨ªå•æ™‚é–“
- `visit_count`: è¨ªå•æ¬¡æ•¸

## éƒ¨ç½²èªªæ˜

### Docker éƒ¨ç½²

1. **å»ºç«‹ç’°å¢ƒè®Šæ•¸æª”æ¡ˆ**
```bash
   cp .env.example .env.local
   # ç·¨è¼¯ .env.local
```

2. **ç¢ºä¿ä¸Šå‚³ç›®éŒ„å­˜åœ¨ä¸¦æœ‰æ­£ç¢ºæ¬Šé™**
```bash
   mkdir -p public/uploads/thumbnails public/uploads/story
   chmod -R 777 public/uploads  # æˆ–ä½¿ç”¨ chown -R 1001:1001 public/uploads
```

3. **å•Ÿå‹•æœå‹™**
```bash
docker-compose up -d --build
```

4. **åˆå§‹åŒ–è³‡æ–™åº«**ï¼ˆé¦–æ¬¡éƒ¨ç½²ï¼‰
```bash
   docker-compose exec app npm run init-db
   # æˆ–ä½¿ç”¨ API ç«¯é»
   curl -X POST http://localhost:3000/api/init
   ```

5. **åŒæ­¥å•†å“**ï¼ˆå¯é¸ï¼‰
   - ç™»å…¥å¾Œå°ï¼šhttps://showartz.com/admin
   - é»æ“Šã€ŒåŒæ­¥ Pinkoi å•†å“ã€æˆ–ã€ŒåŒæ­¥ Shopee å•†å“ã€

#### Docker Volume é…ç½®

`docker-compose.yml` ä¸­å·²é…ç½® volume æ˜ å°„ï¼Œç¢ºä¿ä¸Šå‚³çš„æ–‡ä»¶æŒä¹…åŒ–ï¼š

```yaml
volumes:
  - ./public/uploads:/app/public/uploads
```

é€™ç¢ºä¿ï¼š
- ä¸Šå‚³çš„æ–‡ä»¶ä¿å­˜åœ¨ä¸»æ©Ÿçš„ `public/uploads` ç›®éŒ„
- å®¹å™¨é‡å•Ÿå¾Œæ–‡ä»¶ä¸æœƒä¸Ÿå¤±
- Nginx å¯ä»¥ç›´æ¥è¨ªå•é€™äº›æ–‡ä»¶

### Nginx åå‘ä»£ç†é…ç½®

#### åŸºæœ¬é…ç½®

ç·¨è¼¯ `/etc/nginx/sites-available/showartz`ï¼š

```nginx
# HTTP é‡å®šå‘åˆ° HTTPS
server {
    listen 80;
    server_name showartz.com www.showartz.com;
    return 301 https://$host$request_uri;
}

# HTTPS ä¸»é…ç½®
server {
    listen 443 ssl;
    server_name showartz.com www.showartz.com;

    # å¢åŠ å®¢æˆ¶ç«¯è«‹æ±‚é«”å¤§å°é™åˆ¶ï¼ˆ10MBï¼‰- ç”¨æ–¼æ–‡ä»¶ä¸Šå‚³
    client_max_body_size 10M;

    # SSL è­‰æ›¸é…ç½®ï¼ˆç”± Certbot ç®¡ç†ï¼‰
    ssl_certificate /etc/letsencrypt/live/showartz.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/showartz.com/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;

    # ç›´æ¥æœå‹™ä¸Šå‚³çš„æ–‡ä»¶ï¼ˆç¹é Next.js standalone æ¨¡å¼é™åˆ¶ï¼‰
    location /uploads/ {
        alias /opt/showartz/public/uploads/;
        expires 30d;
        add_header Cache-Control "public, immutable";
        access_log off;
    }

    location / {
        proxy_pass http://localhost:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
    }
}
```

#### å•Ÿç”¨ç«™é»

```bash
sudo ln -s /etc/nginx/sites-available/showartz /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
sudo certbot --nginx -d showartz.com -d www.showartz.com
```

#### é‡è¦é…ç½®èªªæ˜

1. **`client_max_body_size 10M`**ï¼šå…è¨±ä¸Šå‚³æœ€å¤§ 10MB çš„æ–‡ä»¶ï¼ˆè§£æ±º 413 éŒ¯èª¤ï¼‰
2. **`location /uploads/`**ï¼šç›´æ¥æœå‹™ä¸Šå‚³çš„æ–‡ä»¶ï¼Œå› ç‚º Next.js standalone æ¨¡å¼ä¸æœƒè‡ªå‹•æœå‹™é‹è¡Œæ™‚ä¸Šå‚³çš„æ–‡ä»¶
3. **Docker Volume æ˜ å°„**ï¼š`docker-compose.yml` ä¸­å·²é…ç½® `./public/uploads:/app/public/uploads`ï¼Œç¢ºä¿æ–‡ä»¶æŒä¹…åŒ–

### æ•…éšœæ’é™¤

#### 502 Bad Gateway éŒ¯èª¤

å¦‚æœé‡åˆ° 502 éŒ¯èª¤ï¼Œè«‹åƒè€ƒ [DEPLOY_FIX_502.md](./DEPLOY_FIX_502.md) è©³ç´°æŒ‡å—ã€‚

**å¿«é€Ÿä¿®å¾©**ï¼š
```bash
cd /opt/showartz
bash scripts/diagnose-502.sh  # è¨ºæ–·å•é¡Œ
bash scripts/fix-502.sh       # è‡ªå‹•ä¿®å¾©
```

**å¸¸è¦‹åŸå› **ï¼š
- Docker å®¹å™¨æœªé‹è¡Œæˆ–å´©æ½°
- æ‡‰ç”¨å•Ÿå‹•å¤±æ•—ï¼ˆæª¢æŸ¥æ—¥èªŒï¼š`docker-compose logs app`ï¼‰
- ç«¯å£è¡çªæˆ– Nginx é…ç½®éŒ¯èª¤
- ç’°å¢ƒè®Šæ•¸ç¼ºå¤±æˆ–éŒ¯èª¤

## éƒ¨ç½²åˆ° GitHub mainï¼ˆå«ç³»çµ±æ›´æ–°æ³¨æ„äº‹é …ï¼‰

> æœ¬ç¯€ç‚ºæ“ä½œæŒ‡å—ï¼Œæœªåœ¨æ­¤æ–‡ä»¶ä¸­è‡ªå‹•åŸ·è¡Œä»»ä½• git æˆ–éƒ¨ç½²å‘½ä»¤ã€‚

1. **æª¢æŸ¥ç‹€æ…‹èˆ‡å“è³ª**  
   ```bash
   git status
   npm run lint
   ```

2. **ï¼ˆå¯é¸ï¼‰æ›´æ–°ç‰ˆæœ¬/ç´€éŒ„**  
   - è‹¥æœ‰ç‰ˆæœ¬è™Ÿæˆ–æ—¥æœŸè®Šæ›´ï¼Œè«‹åŒæ­¥æ›´æ–° `README.md` æˆ– `DEPLOYMENT_STATUS.md`ã€‚

3. **æäº¤ä¸¦æ¨é€åˆ° GitHub main**  
   ```bash
   git add .
   git commit -m "chore: update docs & deploy notes"
   git push origin main
   ```

4. **ä¼ºæœå™¨ç«¯æ‹‰å– main ä¸¦é‡å•Ÿ**  
   ```bash
   git pull origin main
   docker compose pull
   docker compose up -d --build
   ```
   - è‹¥ä¼ºæœå™¨å·²é€²è¡Œç³»çµ±å¥—ä»¶æ›´æ–°ï¼ˆå¦‚ apt/yumï¼‰ï¼Œè«‹å…ˆé‡å•Ÿ Docker æœå‹™å†é‡å»ºï¼š  
     ```bash
     sudo systemctl restart docker
     docker compose up -d --build
     ```

5. **é©—è­‰éƒ¨ç½²**  
   ```bash
   docker compose ps
   docker compose logs -f app   # è‹¥æœå‹™åç¨±ä¸åŒè«‹æ›¿æ›
   curl -I https://showartz.com
   ```

6. **ï¼ˆé¸ç”¨ï¼‰ç¶­è­·æ¨¡å¼**  
   - è‹¥éœ€çŸ­æš«ä¸‹ç·šï¼Œå¯åœ¨ Nginx æˆ– CDN é–‹å•Ÿç¶­è­·é ï¼Œéƒ¨ç½²å®Œæˆå¾Œå†æ¢å¾©ã€‚

## å°ˆæ¡ˆçµæ§‹

```
showartz251120/
â”œâ”€â”€ app/                      # Next.js App Router
â”‚   â”œâ”€â”€ api/                  # API Routes
â”‚   â”‚   â”œâ”€â”€ admin/           # ç®¡ç†å“¡ API
â”‚   â”‚   â”‚   â”œâ”€â”€ users/       # æœƒå“¡ç®¡ç† API
â”‚   â”‚   â”‚   â””â”€â”€ reset-password/  # å¯†ç¢¼é‡ç½®
â”‚   â”‚   â”œâ”€â”€ analytics/       # è¨ªå®¢çµ±è¨ˆ API
â”‚   â”‚   â”‚   â”œâ”€â”€ pageview/    # é é¢ç€è¦½è¨˜éŒ„
â”‚   â”‚   â”‚   â”œâ”€â”€ session/     # æœƒè©±ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ stats/       # çµ±è¨ˆæ•¸æ“š
â”‚   â”‚   â”œâ”€â”€ auth/            # èªè­‰ç›¸é—œ
â”‚   â”‚   â”‚   â”œâ”€â”€ user/        # ç”¨æˆ¶èªè­‰
â”‚   â”‚   â”‚   â””â”€â”€ session/     # Session ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ products/        # å•†å“ API
â”‚   â”‚   â”œâ”€â”€ pinkoi/          # Pinkoi åŒæ­¥
â”‚   â”‚   â”œâ”€â”€ search/          # èŠå¤© API
â”‚   â”‚   â””â”€â”€ videos/          # å½±ç‰‡ API
â”‚   â”œâ”€â”€ admin/               # å¾Œå°é é¢
â”‚   â”œâ”€â”€ account/             # æœƒå“¡ä¸­å¿ƒ
â”‚   â”œâ”€â”€ login/               # ç™»å…¥é é¢
â”‚   â”œâ”€â”€ register/            # è¨»å†Šé é¢
â”‚   â”œâ”€â”€ space/               # ç©ºé–“é é¢
â”‚   â”œâ”€â”€ products/            # å•†å“é é¢
â”‚   â”œâ”€â”€ about/               # é—œæ–¼é é¢
â”‚   â””â”€â”€ page.tsx             # é¦–é 
â”œâ”€â”€ components/              # React çµ„ä»¶
â”‚   â”œâ”€â”€ admin/               # å¾Œå°çµ„ä»¶
â”‚   â”‚   â”œâ”€â”€ AnalyticsDashboard.tsx  # è¨ªå®¢çµ±è¨ˆå„€è¡¨æ¿
â”‚   â”‚   â”œâ”€â”€ UserManager.tsx  # æœƒå“¡ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ ProductManager.tsx  # å•†å“ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ VideoManager.tsx   # åª’é«”ç®¡ç†
â”‚   â”‚   â””â”€â”€ ImageManager.tsx   # åœ–ç‰‡ç®¡ç†
â”‚   â”œâ”€â”€ Analytics.tsx        # è¨ªå®¢è¿½è¹¤çµ„ä»¶
â”‚   â”œâ”€â”€ SearchAgent.tsx      # AI èŠå¤©çµ„ä»¶ï¼ˆè—æ£§ç²¾éˆï¼‰
â”‚   â”œâ”€â”€ VideoGrid.tsx        # å½±ç‰‡ç¶²æ ¼
â”‚   â”œâ”€â”€ ProductGrid.tsx      # å•†å“ç¶²æ ¼
â”‚   â”œâ”€â”€ Navigation.tsx       # å°èˆªåˆ—
â”‚   â””â”€â”€ Footer.tsx           # Footer ç‰ˆæ¬Šå€å¡Š
â”œâ”€â”€ lib/                      # å·¥å…·å‡½æ•¸
â”‚   â”œâ”€â”€ db.ts                # è³‡æ–™åº«æ“ä½œ
â”‚   â”œâ”€â”€ openai.ts            # OpenAI æ•´åˆ
â”‚   â”œâ”€â”€ openai-functions.ts  # Function Calling
â”‚   â”œâ”€â”€ chat-limiter.ts      # èŠå¤©é™æµ
â”‚   â”œâ”€â”€ pinkoi-sync.ts       # Pinkoi åŒæ­¥
â”‚   â””â”€â”€ auth.ts              # èªè­‰å·¥å…·
â”œâ”€â”€ scripts/                  # è…³æœ¬
â”‚   â””â”€â”€ init-db.mjs          # è³‡æ–™åº«åˆå§‹åŒ–
â”œâ”€â”€ docs/                     # æ–‡æª”
â”‚   â”œâ”€â”€ SYSTEM_OPTIMIZATION_REPORT.md  # ç³»çµ±å„ªåŒ–å ±å‘Š
â”‚   â”œâ”€â”€ ANALYSIS_REPORT.md   # ç³»çµ±åˆ†æå ±å‘Š
â”‚   â””â”€â”€ OPTIMIZATION_REPORT.md  # å„ªåŒ–å ±å‘Š
â”œâ”€â”€ readme/                   # æ–‡æª”
â”‚   â”œâ”€â”€ OpenAI Assistant é…ç½®æŒ‡å—.md
â”‚   â”œâ”€â”€ showartz Tarot é¡§å•ï¼‹å•†å“æ¨è–¦åŠ©ç†æç¤ºè©
â”‚   â””â”€â”€ showartz_product_tools_schema.json
â”œâ”€â”€ public/                   # éœæ…‹è³‡æº
â”œâ”€â”€ docker-compose.yml        # Docker Compose é…ç½®
â”œâ”€â”€ Dockerfile               # Docker æ˜ åƒæª”
â””â”€â”€ package.json             # å°ˆæ¡ˆä¾è³´
```

## æ³¨æ„äº‹é …

1. **ç’°å¢ƒè®Šæ•¸**ï¼š`.env.local` ä¸æ‡‰æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»çµ±
2. **è³‡æ–™åº«å¯†ç¢¼**ï¼šç”Ÿç”¢ç’°å¢ƒè«‹å‹™å¿…æ›´æ”¹é è¨­å¯†ç¢¼
3. **OpenAI API Key**ï¼šè«‹å¦¥å–„ä¿ç®¡ï¼Œé¿å…æ´©éœ²
4. **IP é™æµ**ï¼šç›®å‰ä½¿ç”¨å…§å­˜å­˜å„²ï¼Œé‡å•Ÿå¾Œæœƒé‡ç½®ã€‚ç”Ÿç”¢ç’°å¢ƒå»ºè­°ä½¿ç”¨ Redis
5. **å•†å“åŒæ­¥**ï¼šPinkoi åŒæ­¥å¯èƒ½éœ€è¦è¼ƒé•·æ™‚é–“ï¼Œè«‹è€å¿ƒç­‰å¾…
6. **Pinkoi åŒæ­¥æ¸…ç†ï¼ˆ2025-12 æ›´æ–°ï¼‰**ï¼šæŒ‰ä¸‹å¾Œå°ã€ŒåŒæ­¥ Pinkoi å•†å“ã€æ™‚ï¼Œç³»çµ±æœƒï¼š
   - é‡æ–°æŠ“å– Pinkoi å•†å“ä¸¦éæ¿¾æ‰å ä½åœ– `space.gif`
   - åŒæ­¥å®Œæˆå¾Œï¼Œè‡ªå‹•æ¸…ç†è³‡æ–™åº«ä¸­çš„å ä½åœ–æ¬„ä½ï¼ˆimage_url / image_urls æœƒè¢«è¨­ç‚º NULLï¼‰
   - å°‡æ²’æœ‰ä»»ä½•åœ–ç‰‡çš„å•†å“æ¨™è¨˜ç‚ºä¸‹æ¶ï¼ˆis_active=falseï¼‰ï¼Œå‰å°ä¸å†é¡¯ç¤ºç„¡åœ–å•†å“
7. **LOGO è¨­å®š**ï¼šè«‹å°‡ LOGO åœ–ç‰‡æ”¾åœ¨ `public/showartzlogo.*`
8. **Pinkoi å¹£åˆ¥ä¾†æºå·®ç•°**ï¼šä¸»æ©Ÿä½æ–¼æ—¥æœ¬æ™‚ï¼ŒPinkoi API å¸¸å›å‚³æ—¥å¹£ (JPY)ï¼Œéœ€é€é Header/Cookie æˆ–æ›ç®—ç‚º TWDï¼›æœ¬æ©Ÿï¼ˆå°ç£ï¼‰é€šå¸¸ç›´æ¥å–å¾— TWDã€‚è‹¥è¦é¿å…æ›ç®—ï¼Œå»ºè­°å°‡ä¸»æ©Ÿè¨­æ–¼å°ç£ï¼ˆä¾‹ï¼šVultr å°åŒ—ç¯€é»ï¼‰ï¼Œç›´æ¥å–å¾— TWD åƒ¹æ ¼ã€‚

## æˆæ¬Š

ç‰ˆæ¬Šæ‰€æœ‰ Â© 2024 è—æ£§ Showartz
